// 标准化知识点标签库
// 用于统一AI生成的标签，避免同一知识点有多种表达

// ==================== 类型定义 ====================

/**
 * 课程小节(最细粒度)
 */
interface CurriculumSubsection {
    subsection: string;  // 小节名称,如 "1.2.1 有理数"
    tags: string[];      // 该小节包含的知识点标签
}

/**
 * 课程节
 */
interface CurriculumSection {
    section: string;                      // 节名称,如 "1.2 有理数"
    tags?: string[];                      // 直接在节下的标签(可选)
    subsections?: CurriculumSubsection[]; // 子小节(可选)
}

/**
 * 课程章
 */
interface CurriculumChapter {
    chapter: string;              // 章名称,如 "第1章 有理数"
    sections: CurriculumSection[]; // 章下的所有节
}

/**
 * 数学课程大纲
 */
type MathCurriculum = Record<string, CurriculumChapter[]>;

/**
 * 标签索引(用于快速查询)
 */
export interface MathTagIndex {
    name: string;        // 标签名称
    grade: 7 | 8 | 9 | 10 | 11 | 12;   // 年级 (7-9:初中, 10-12:高中)
    semester: 1 | 2;    // 学期
    chapter: string;    // 章节
    section: string;    // 小节
    path: string;       // 完整路径,如 "七年级上/第1章 有理数/1.2.4 绝对值"
}

// ==================== 数学课程数据(单一数据源) ====================

/**
 * 人教版数学课程大纲
 * 这是数学标签的唯一数据源,所有查询索引都从这里自动生成
 */
export const MATH_CURRICULUM: MathCurriculum = {
    '七年级上': [
        {
            chapter: '第1章 有理数',
            sections: [
                {
                    section: '1.1 正数和负数',
                    tags: ['正数和负数']
                },
                {
                    section: '1.2 有理数',
                    subsections: [
                        { subsection: '1.2.1 有理数', tags: ['有理数'] },
                        { subsection: '1.2.2 数轴', tags: ['数轴'] },
                        { subsection: '1.2.3 相反数', tags: ['相反数'] },
                        { subsection: '1.2.4 绝对值', tags: ['绝对值', '非负数的性质：绝对值', '有理数大小比较'] }
                    ]
                },
                {
                    section: '1.3 有理数的加减法',
                    subsections: [
                        { subsection: '1.3.1 有理数的加法', tags: ['有理数的加法'] },
                        { subsection: '1.3.2 有理数的减法', tags: ['有理数的减法', '有理数的加减混合运算'] }
                    ]
                },
                {
                    section: '1.4 有理数的乘除法',
                    subsections: [
                        { subsection: '1.4.1 有理数的乘法', tags: ['倒数', '有理数的乘法'] },
                        { subsection: '1.4.2 有理数的除法', tags: ['有理数的除法'] }
                    ]
                },
                {
                    section: '1.5 有理数的乘方',
                    subsections: [
                        { subsection: '1.5.1 乘方', tags: ['有理数的乘方', '非负数的性质：偶次方', '有理数的混合运算'] },
                        { subsection: '1.5.2 科学记数法', tags: ['科学记数法—表示较大的数'] },
                        { subsection: '1.5.3 近似数', tags: ['近似数和有效数字'] }
                    ]
                }
            ]
        },
        {
            chapter: '第2章 整式的加减',
            sections: [
                {
                    section: '2.1 整式',
                    tags: ['代数式', '列代数式', '代数式求值', '整式', '单项式', '多项式']
                },
                {
                    section: '2.2 整式的加减',
                    tags: ['同类项', '合并同类项', '去括号与添括号', '整式的加减', '整式的加减—化简求值']
                }
            ]
        },
        {
            chapter: '第3章 一元一次方程',
            sections: [
                {
                    section: '3.1 从算式到方程',
                    subsections: [
                        { subsection: '3.1.1 一元一次方程', tags: ['方程的定义', '方程的解', '一元一次方程的定义'] },
                        { subsection: '3.1.2 等式的性质', tags: ['等式的性质', '一元一次方程的解'] }
                    ]
                },
                {
                    section: '3.2 解一元一次方程(一)——合并同类项与移项',
                    tags: ['解一元一次方程']
                },
                {
                    section: '3.3 解一元一次方程(二)——去括号与去分母',
                    tags: ['解一元一次方程']
                },
                {
                    section: '3.4 实际问题与一元一次方程',
                    tags: ['由实际问题抽象出一元一次方程', '一元一次方程的应用']
                }
            ]
        },
        {
            chapter: '第4章 几何图形初步',
            sections: [
                {
                    section: '4.1 几何图形',
                    subsections: [
                        { subsection: '4.1.1 立体图形与平面图形', tags: ['认识立体图形', '认识平面图形'] },
                        { subsection: '4.1.2 点、线、面、体', tags: ['点、线、面、体'] }
                    ]
                },
                {
                    section: '4.2 直线、射线、线段',
                    tags: ['直线、射线、线段', '直线的性质：两点确定一条直线', '线段的性质：两点之间线段最短', '两点间的距离', '比较线段的长短']
                },
                {
                    section: '4.3 角',
                    subsections: [
                        { subsection: '4.3.1 角', tags: ['角的概念', '钟面角', '方向角', '度分秒的换算'] },
                        { subsection: '4.3.2 角的比较与运算', tags: ['角平分线的定义', '角的计算', '角的大小比较'] },
                        { subsection: '4.3.3 余角和补角', tags: ['余角和补角'] }
                    ]
                }
            ]
        }
    ],
    '七年级下': [
        {
            chapter: '第5章 相交线与平行线',
            sections: [
                {
                    section: '5.1 相交线',
                    subsections: [
                        { subsection: '5.1.1 相交线', tags: ['相交线', '对顶角', '邻补角'] },
                        { subsection: '5.1.2 垂线', tags: ['垂线', '垂线段最短', '点到直线的距离'] },
                        { subsection: '5.1.3 同位角、内错角、同旁内角', tags: ['同位角', '内错角', '同旁内角'] }
                    ]
                },
                {
                    section: '5.2 平行线及其判定',
                    subsections: [
                        { subsection: '5.2.1 平行线', tags: ['平行线', '平行公理'] },
                        { subsection: '5.2.2 平行线的判定', tags: ['平行线的判定'] }
                    ]
                },
                {
                    section: '5.3 平行线的性质',
                    subsections: [
                        { subsection: '5.3.1 平行线的性质', tags: ['平行线的性质'] },
                        { subsection: '5.3.2 命题、定理、证明', tags: ['命题', '定理', '证明'] }
                    ]
                },
                {
                    section: '5.4 平移',
                    tags: ['平移', '平移的性质']
                }
            ]
        },
        {
            chapter: '第6章 实数',
            sections: [
                {
                    section: '6.1 平方根',
                    tags: ['平方根', '算术平方根']
                },
                {
                    section: '6.2 立方根',
                    tags: ['立方根']
                },
                {
                    section: '6.3 实数',
                    tags: ['实数', '无理数', '实数的大小比较']
                }
            ]
        },
        {
            chapter: '第7章 平面直角坐标系',
            sections: [
                {
                    section: '7.1 平面直角坐标系',
                    subsections: [
                        { subsection: '7.1.1 有序数对', tags: ['有序数对'] },
                        { subsection: '7.1.2 平面直角坐标系', tags: ['平面直角坐标系', '象限', '点的坐标'] }
                    ]
                },
                {
                    section: '7.2 坐标方法的简单应用',
                    subsections: [
                        { subsection: '7.2.1 用坐标表示地理位置', tags: ['用坐标表示地理位置'] },
                        { subsection: '7.2.2 用坐标表示平移', tags: ['用坐标表示平移'] }
                    ]
                }
            ]
        },
        {
            chapter: '第8章 二元一次方程组',
            sections: [
                {
                    section: '8.1 二元一次方程组',
                    tags: ['二元一次方程', '二元一次方程组', '二元一次方程组的解']
                },
                {
                    section: '8.2 消元——解二元一次方程组',
                    tags: ['代入消元法', '加减消元法']
                },
                {
                    section: '8.3 实际问题与二元一次方程组',
                    tags: ['二元一次方程组的应用']
                },
                {
                    section: '8.4 三元一次方程组的解法',
                    tags: ['三元一次方程组']
                }
            ]
        },
        {
            chapter: '第9章 不等式与不等式组',
            sections: [
                {
                    section: '9.1 不等式',
                    subsections: [
                        { subsection: '9.1.1 不等式及其解集', tags: ['不等式', '不等式的解集'] },
                        { subsection: '9.1.2 不等式的性质', tags: ['不等式的性质'] }
                    ]
                },
                {
                    section: '9.2 一元一次不等式',
                    tags: ['一元一次不等式', '一元一次不等式的应用']
                },
                {
                    section: '9.3 一元一次不等式组',
                    tags: ['一元一次不等式组', '一元一次不等式组的应用']
                }
            ]
        },
        {
            chapter: '第10章 数据的收集、整理与描述',
            sections: [
                {
                    section: '10.1 统计调查',
                    tags: ['全面调查', '抽样调查', '总体', '个体', '样本', '样本容量']
                },
                {
                    section: '10.2 直方图',
                    tags: ['频数分布直方图', '频数', '频率']
                }
            ]
        }
    ],
    '八年级上': [
        {
            chapter: '第11章 三角形',
            sections: [
                {
                    section: '11.1 与三角形有关的线段',
                    subsections: [
                        { subsection: '11.1.1 三角形的边', tags: ['三角形的边', '三角形三边关系'] },
                        { subsection: '11.1.2 三角形的高、中线与角平分线', tags: ['三角形的高', '三角形的中线', '三角形的角平分线'] },
                        { subsection: '11.1.3 三角形的稳定性', tags: ['三角形的稳定性'] }
                    ]
                },
                {
                    section: '11.2 与三角形有关的角',
                    subsections: [
                        { subsection: '11.2.1 三角形的内角', tags: ['三角形内角和定理'] },
                        { subsection: '11.2.2 三角形的外角', tags: ['三角形的外角性质'] }
                    ]
                },
                {
                    section: '11.3 多边形及其内角和',
                    subsections: [
                        { subsection: '11.3.1 多边形', tags: ['多边形', '正多边形'] },
                        { subsection: '11.3.2 多边形的内角和', tags: ['多边形内角和', '多边形外角和'] }
                    ]
                }
            ]
        },
        {
            chapter: '第12章 全等三角形',
            sections: [
                {
                    section: '12.1 全等三角形',
                    tags: ['全等三角形', '全等三角形的性质']
                },
                {
                    section: '12.2 三角形全等的判定',
                    tags: ['全等三角形的判定', 'SSS', 'SAS', 'ASA', 'AAS', 'HL']
                },
                {
                    section: '12.3 角平分线的性质',
                    tags: ['角平分线的性质', '角平分线的判定']
                }
            ]
        },
        {
            chapter: '第13章 轴对称',
            sections: [
                {
                    section: '13.1 轴对称',
                    subsections: [
                        { subsection: '13.1.1 轴对称', tags: ['轴对称', '轴对称图形'] },
                        { subsection: '13.1.2 线段的垂直平分线的性质', tags: ['线段垂直平分线的性质', '线段垂直平分线的判定'] }
                    ]
                },
                {
                    section: '13.2 画轴对称图形',
                    tags: ['画轴对称图形']
                },
                {
                    section: '13.3 等腰三角形',
                    subsections: [
                        { subsection: '13.3.1 等腰三角形', tags: ['等腰三角形', '等腰三角形的性质', '等腰三角形的判定'] },
                        { subsection: '13.3.2 等边三角形', tags: ['等边三角形', '等边三角形的性质', '等边三角形的判定'] }
                    ]
                },
                {
                    section: '13.4 课题学习 最短路径问题',
                    tags: ['最短路径问题', '将军饮马问题']
                }
            ]
        },
        {
            chapter: '第14章 整式的乘法与因式分解',
            sections: [
                {
                    section: '14.1 整式的乘法',
                    subsections: [
                        { subsection: '14.1.1 同底数幂的乘法', tags: ['同底数幂的乘法'] },
                        { subsection: '14.1.2 幂的乘方', tags: ['幂的乘方'] },
                        { subsection: '14.1.3 积的乘方', tags: ['积的乘方'] },
                        { subsection: '14.1.4 整式的乘法', tags: ['单项式乘以单项式', '单项式乘以多项式', '多项式乘以多项式'] }
                    ]
                },
                {
                    section: '14.2 乘法公式',
                    subsections: [
                        { subsection: '14.2.1 平方差公式', tags: ['平方差公式'] },
                        { subsection: '14.2.2 完全平方公式', tags: ['完全平方公式', '添括号法则'] }
                    ]
                },
                {
                    section: '14.3 因式分解',
                    subsections: [
                        { subsection: '14.3.1 提公因式法', tags: ['提公因式法'] },
                        { subsection: '14.3.2 公式法', tags: ['公式法分解因式'] }
                    ]
                }
            ]
        },
        {
            chapter: '第15章 分式',
            sections: [
                {
                    section: '15.1 分式',
                    subsections: [
                        { subsection: '15.1.1 从分数到分式', tags: ['分式', '分式有意义的条件'] },
                        { subsection: '15.1.2 分式的基本性质', tags: ['分式的基本性质', '约分', '通分'] }
                    ]
                },
                {
                    section: '15.2 分式的运算',
                    subsections: [
                        { subsection: '15.2.1 分式的乘除', tags: ['分式的乘法', '分式的除法', '分式的乘方'] },
                        { subsection: '15.2.2 分式的加减', tags: ['分式的加减'] },
                        { subsection: '15.2.3 整数指数幂', tags: ['整数指数幂', '科学记数法—表示较小的数'] }
                    ]
                },
                {
                    section: '15.3 分式方程',
                    tags: ['分式方程', '分式方程的解法', '分式方程的应用']
                }
            ]
        }
    ],
    '八年级下': [
        {
            chapter: '第16章 二次根式',
            sections: [
                {
                    section: '16.1 二次根式',
                    tags: ['二次根式', '二次根式有意义的条件']
                },
                {
                    section: '16.2 二次根式的乘除',
                    tags: ['二次根式的乘法', '二次根式的除法', '最简二次根式']
                },
                {
                    section: '16.3 二次根式的加减',
                    tags: ['二次根式的加减', '二次根式的混合运算']
                }
            ]
        },
        {
            chapter: '第17章 勾股定理',
            sections: [
                {
                    section: '17.1 勾股定理',
                    tags: ['勾股定理', '勾股定理的应用']
                },
                {
                    section: '17.2 勾股定理的逆定理',
                    tags: ['勾股定理的逆定理']
                }
            ]
        },
        {
            chapter: '第18章 平行四边形',
            sections: [
                {
                    section: '18.1 平行四边形',
                    subsections: [
                        { subsection: '18.1.1 平行四边形的性质', tags: ['平行四边形的性质'] },
                        { subsection: '18.1.2 平行四边形的判定', tags: ['平行四边形的判定'] }
                    ]
                },
                {
                    section: '18.2 特殊的平行四边形',
                    subsections: [
                        { subsection: '18.2.1 矩形', tags: ['矩形的性质', '矩形的判定'] },
                        { subsection: '18.2.2 菱形', tags: ['菱形的性质', '菱形的判定'] },
                        { subsection: '18.2.3 正方形', tags: ['正方形的性质', '正方形的判定'] }
                    ]
                }
            ]
        },
        {
            chapter: '第19章 一次函数',
            sections: [
                {
                    section: '19.1 函数',
                    subsections: [
                        { subsection: '19.1.1 变量与函数', tags: ['变量', '常量', '函数', '自变量的取值范围'] },
                        { subsection: '19.1.2 函数的图象', tags: ['函数的图象', '描点法'] }
                    ]
                },
                {
                    section: '19.2 一次函数',
                    subsections: [
                        { subsection: '19.2.1 正比例函数', tags: ['正比例函数', '正比例函数的图象和性质'] },
                        { subsection: '19.2.2 一次函数', tags: ['一次函数', '一次函数的图象和性质', '待定系数法求一次函数解析式'] },
                        { subsection: '19.2.3 一次函数与方程、不等式', tags: ['一次函数与一元一次方程', '一次函数与一元一次不等式', '一次函数与二元一次方程组'] }
                    ]
                },
                {
                    section: '19.3 课题学习 选择方案',
                    tags: ['一次函数的应用']
                }
            ]
        },
        {
            chapter: '第20章 数据的分析',
            sections: [
                {
                    section: '20.1 数据的集中趋势',
                    subsections: [
                        { subsection: '20.1.1 平均数', tags: ['算术平均数', '加权平均数'] },
                        { subsection: '20.1.2 中位数和众数', tags: ['中位数', '众数'] }
                    ]
                },
                {
                    section: '20.2 数据的波动程度',
                    tags: ['方差', '极差']
                }
            ]
        }
    ],
    '九年级上': [
        {
            chapter: '第21章 一元二次方程',
            sections: [
                {
                    section: '21.1 一元二次方程',
                    tags: ['一元二次方程', '一元二次方程的一般形式']
                },
                {
                    section: '21.2 解一元二次方程',
                    subsections: [
                        { subsection: '21.2.1 配方法', tags: ['直接开平方法', '配方法'] },
                        { subsection: '21.2.2 公式法', tags: ['一元二次方程求根公式', '根的判别式'] },
                        { subsection: '21.2.3 因式分解法', tags: ['因式分解法解一元二次方程'] },
                        { subsection: '21.2.4 一元二次方程的根与系数的关系', tags: ['韦达定理'] }
                    ]
                },
                {
                    section: '21.3 实际问题与一元二次方程',
                    tags: ['一元二次方程的应用']
                }
            ]
        },
        {
            chapter: '第22章 二次函数',
            sections: [
                {
                    section: '22.1 二次函数的图象和性质',
                    subsections: [
                        { subsection: '22.1.1 二次函数', tags: ['二次函数'] },
                        { subsection: '22.1.2 二次函数y=ax²的图象和性质', tags: ['二次函数y=ax²的图象和性质'] },
                        { subsection: '22.1.3 二次函数y=a(x-h)²+k的图象和性质', tags: ['二次函数顶点式'] },
                        { subsection: '22.1.4 二次函数y=ax²+bx+c的图象和性质', tags: ['二次函数一般式', '抛物线的顶点坐标', '抛物线的对称轴'] }
                    ]
                },
                {
                    section: '22.2 二次函数与一元二次方程',
                    tags: ['二次函数与一元二次方程的关系']
                },
                {
                    section: '22.3 实际问题与二次函数',
                    tags: ['二次函数的应用', '最大值/最小值问题']
                }
            ]
        },
        {
            chapter: '第23章 旋转',
            sections: [
                {
                    section: '23.1 图形的旋转',
                    tags: ['旋转', '旋转的性质']
                },
                {
                    section: '23.2 中心对称',
                    subsections: [
                        { subsection: '23.2.1 中心对称', tags: ['中心对称', '中心对称的性质'] },
                        { subsection: '23.2.2 中心对称图形', tags: ['中心对称图形'] },
                        { subsection: '23.2.3 关于原点对称的点的坐标', tags: ['关于原点对称的点的坐标'] }
                    ]
                }
            ]
        },
        {
            chapter: '第24章 圆',
            sections: [
                {
                    section: '24.1 圆的有关性质',
                    subsections: [
                        { subsection: '24.1.1 圆', tags: ['圆', '弦', '弧'] },
                        { subsection: '24.1.2 垂直于弦的直径', tags: ['垂径定理'] },
                        { subsection: '24.1.3 弧、弦、圆心角', tags: ['圆心角', '弧、弦、圆心角的关系'] },
                        { subsection: '24.1.4 圆周角', tags: ['圆周角', '圆周角定理'] }
                    ]
                },
                {
                    section: '24.2 点和圆、直线和圆的位置关系',
                    subsections: [
                        { subsection: '24.2.1 点和圆的位置关系', tags: ['点和圆的位置关系', '三角形的外接圆'] },
                        { subsection: '24.2.2 直线和圆的位置关系', tags: ['直线和圆的位置关系', '切线的判定', '切线的性质', '切线长定理', '三角形的内切圆'] }
                    ]
                },
                {
                    section: '24.3 正多边形和圆',
                    tags: ['正多边形和圆']
                },
                {
                    section: '24.4 弧长和扇形面积',
                    tags: ['弧长公式', '扇形面积公式', '圆锥的侧面积和全面积']
                }
            ]
        },
        {
            chapter: '第25章 概率初步',
            sections: [
                {
                    section: '25.1 随机事件与概率',
                    subsections: [
                        { subsection: '25.1.1 随机事件', tags: ['随机事件', '必然事件', '不可能事件'] },
                        { subsection: '25.1.2 概率', tags: ['概率'] }
                    ]
                },
                {
                    section: '25.2 用列举法求概率',
                    tags: ['列表法', '树状图法']
                },
                {
                    section: '25.3 用频率估计概率',
                    tags: ['用频率估计概率']
                }
            ]
        }
    ],
    '九年级下': [
        {
            chapter: '第26章 反比例函数',
            sections: [
                {
                    section: '26.1 反比例函数',
                    subsections: [
                        { subsection: '26.1.1 反比例函数', tags: ['反比例函数'] },
                        { subsection: '26.1.2 反比例函数的图象和性质', tags: ['反比例函数的图象', '反比例函数的性质'] }
                    ]
                },
                {
                    section: '26.2 实际问题与反比例函数',
                    tags: ['反比例函数的应用']
                }
            ]
        },
        {
            chapter: '第27章 相似',
            sections: [
                {
                    section: '27.1 图形的相似',
                    tags: ['相似图形', '相似多边形', '相似比']
                },
                {
                    section: '27.2 相似三角形',
                    subsections: [
                        { subsection: '27.2.1 相似三角形的判定', tags: ['相似三角形的判定'] },
                        { subsection: '27.2.2 相似三角形的性质', tags: ['相似三角形的性质'] },
                        { subsection: '27.2.3 相似三角形应用举例', tags: ['相似三角形的应用'] }
                    ]
                },
                {
                    section: '27.3 位似',
                    tags: ['位似', '位似图形', '平面直角坐标系中的位似']
                }
            ]
        },
        {
            chapter: '第28章 锐角三角函数',
            sections: [
                {
                    section: '28.1 锐角三角函数',
                    tags: ['正弦', '余弦', '正切', '特殊角的三角函数值']
                },
                {
                    section: '28.2 解直角三角形及其应用',
                    tags: ['解直角三角形', '解直角三角形的应用', '仰角', '俯角', '坡度']
                }
            ]
        },
        {
            chapter: '第29章 投影与视图',
            sections: [
                {
                    section: '29.1 投影',
                    tags: ['投影', '平行投影', '中心投影', '正投影']
                },
                {
                    section: '29.2 三视图',
                    tags: ['三视图', '主视图', '左视图', '俯视图', '由三视图还原几何体']
                }
            ]
        }
    ],
    // ==================== 高中数学 ====================
    '高一上': [
        {
            chapter: '第1章 集合与常用逻辑用语',
            sections: [
                {
                    section: '1.1 集合的概念',
                    tags: ['集合的概念', '集合的表示法', '元素与集合的关系', '集合的分类']
                },
                {
                    section: '1.2 集合间的基本关系',
                    tags: ['子集', '真子集', '空集', '集合相等']
                },
                {
                    section: '1.3 集合的基本运算',
                    tags: ['交集', '并集', '补集', '全集']
                },
                {
                    section: '1.4 常用逻辑用语',
                    tags: ['充分条件', '必要条件', '充要条件', '全称量词', '存在量词', '命题的否定']
                }
            ]
        },
        {
            chapter: '第2章 一元二次函数、方程和不等式',
            sections: [
                {
                    section: '2.1 等式与不等式的性质',
                    tags: ['等式的性质', '不等式的性质', '比较大小']
                },
                {
                    section: '2.2 基本不等式',
                    tags: ['基本不等式', '基本不等式求最值', '基本不等式的应用']
                },
                {
                    section: '2.3 一元二次不等式',
                    tags: ['一元二次不等式', '一元二次不等式的解法', '二次函数与一元二次方程的关系']
                }
            ]
        },
        {
            chapter: '第3章 函数的概念与性质',
            sections: [
                {
                    section: '3.1 函数的概念及其表示',
                    tags: ['函数的概念', '函数的定义域', '函数的值域', '函数的对应法则', '函数的表示方法']
                },
                {
                    section: '3.2 函数的基本性质',
                    tags: ['函数的单调性', '函数的奇偶性', '函数的最大值', '函数的最小值']
                },
                {
                    section: '3.3 幂函数',
                    tags: ['幂函数', '幂函数的图象', '幂函数的性质']
                }
            ]
        },
        {
            chapter: '第4章 指数函数与对数函数',
            sections: [
                {
                    section: '4.1 指数',
                    tags: ['指数的概念', '分数指数幂', '指数运算法则']
                },
                {
                    section: '4.2 指数函数',
                    tags: ['指数函数', '指数函数的图象', '指数函数的性质']
                },
                {
                    section: '4.3 对数',
                    tags: ['对数的概念', '对数运算法则', '换底公式', '常用对数', '自然对数']
                },
                {
                    section: '4.4 对数函数',
                    tags: ['对数函数', '对数函数的图象', '对数函数的性质']
                },
                {
                    section: '4.5 函数的应用',
                    tags: ['函数零点', '零点存在性定理', '二分法', '函数模型应用']
                }
            ]
        }
    ],
    '高一下': [
        {
            chapter: '第5章 平面向量及其应用',
            sections: [
                {
                    section: '5.1 向量的基本概念',
                    tags: ['向量的概念', '向量的表示', '相等向量', '共线向量', '零向量', '单位向量']
                },
                {
                    section: '5.2 向量的加法与减法',
                    tags: ['向量的加法', '向量的减法', '三角形法则', '平行四边形法则']
                },
                {
                    section: '5.3 向量的数乘运算',
                    tags: ['向量的数乘', '向量共线定理']
                },
                {
                    section: '5.4 向量的数量积',
                    tags: ['向量的数量积', '向量夹角', '向量垂直判定', '向量的模']
                },
                {
                    section: '5.5 平面向量基本定理',
                    tags: ['平面向量基本定理', '向量的坐标表示', '向量坐标运算']
                }
            ]
        },
        {
            chapter: '第6章 复数',
            sections: [
                {
                    section: '6.1 复数的概念',
                    tags: ['复数的概念', '实部', '虚部', '纯虚数', '复数相等']
                },
                {
                    section: '6.2 复数的几何意义',
                    tags: ['复平面', '复数的几何意义', '复数的模']
                },
                {
                    section: '6.3 复数的运算',
                    tags: ['复数的加法', '复数的减法', '复数的乘法', '复数的除法']
                }
            ]
        },
        {
            chapter: '第7章 立体几何初步',
            sections: [
                {
                    section: '7.1 空间几何体',
                    tags: ['棱柱', '棱锥', '棱台', '圆柱', '圆锥', '圆台', '球', '组合体']
                },
                {
                    section: '7.2 空间几何体的三视图与直观图',
                    tags: ['三视图', '直观图', '斜二测画法']
                },
                {
                    section: '7.3 空间几何体的表面积与体积',
                    tags: ['棱柱的表面积', '棱锥的表面积', '圆柱的表面积', '圆锥的表面积', '球的表面积', '棱柱的体积', '棱锥的体积', '圆柱的体积', '圆锥的体积', '球的体积']
                },
                {
                    section: '7.4 空间点、直线、平面的位置关系',
                    tags: ['平面的基本性质', '点线面位置关系', '直线与直线平行', '直线与平面平行', '平面与平面平行', '直线与直线垂直', '直线与平面垂直', '平面与平面垂直']
                }
            ]
        },
        {
            chapter: '第8章 统计',
            sections: [
                {
                    section: '8.1 随机抽样',
                    tags: ['简单随机抽样', '系统抽样', '分层抽样']
                },
                {
                    section: '8.2 用样本估计总体',
                    tags: ['频率分布直方图', '频率分布折线图', '茎叶图', '平均数', '众数', '中位数', '标准差', '方差']
                }
            ]
        },
        {
            chapter: '第9章 概率',
            sections: [
                {
                    section: '9.1 随机事件与概率',
                    tags: ['随机事件', '概率', '频率与概率']
                },
                {
                    section: '9.2 古典概型',
                    tags: ['古典概型', '古典概率计算']
                },
                {
                    section: '9.3 几何概型',
                    tags: ['几何概型', '几何概率计算']
                }
            ]
        },
        {
            chapter: '第10章 三角函数',
            sections: [
                {
                    section: '10.1 任意角和弧度制',
                    tags: ['任意角', '弧度制', '角度与弧度换算']
                },
                {
                    section: '10.2 三角函数的概念',
                    tags: ['三角函数的定义', '三角函数线', '同角三角函数关系']
                },
                {
                    section: '10.3 诱导公式',
                    tags: ['诱导公式']
                },
                {
                    section: '10.4 三角函数的图象与性质',
                    tags: ['正弦函数图象', '余弦函数图象', '正切函数图象', '三角函数的周期性', '三角函数的单调性', '三角函数的奇偶性']
                },
                {
                    section: '10.5 函数y=Asin(ωx+φ)的图象与性质',
                    tags: ['y=Asin(ωx+φ)', '振幅', '周期', '初相', '三角函数图象变换']
                },
                {
                    section: '10.6 三角恒等变换',
                    tags: ['两角和差公式', '二倍角公式', '半角公式', '辅助角公式']
                }
            ]
        }
    ],
    // ==================== 高二（选择性必修） ====================
    '高二上': [
        {
            chapter: '第1章 数列',
            sections: [
                {
                    section: '1.1 数列的概念',
                    tags: ['数列的概念', '数列的通项公式', '数列的递推公式']
                },
                {
                    section: '1.2 等差数列',
                    tags: ['等差数列', '等差数列的通项公式', '等差数列的性质', '等差数列前n项和']
                },
                {
                    section: '1.3 等比数列',
                    tags: ['等比数列', '等比数列的通项公式', '等比数列的性质', '等比数列前n项和']
                },
                {
                    section: '1.4 数列求和',
                    tags: ['裂项相消法', '错位相减法', '倒序相加法', '分组求和法']
                }
            ]
        },
        {
            chapter: '第2章 解三角形',
            sections: [
                {
                    section: '2.1 正弦定理',
                    tags: ['正弦定理', '正弦定理的应用']
                },
                {
                    section: '2.2 余弦定理',
                    tags: ['余弦定理', '余弦定理的应用']
                },
                {
                    section: '2.3 解三角形的应用',
                    tags: ['解三角形', '三角形面积公式', '测量问题']
                }
            ]
        }
    ],
    '高二下': [
        {
            chapter: '第3章 直线与圆的方程',
            sections: [
                {
                    section: '3.1 直线的方程',
                    tags: ['直线的斜率', '点斜式', '斜截式', '两点式', '一般式', '直线方程的互化']
                },
                {
                    section: '3.2 直线的位置关系',
                    tags: ['直线平行', '直线垂直', '直线的交点']
                },
                {
                    section: '3.3 距离公式',
                    tags: ['两点间距离公式', '点到直线的距离', '两平行线间的距离']
                },
                {
                    section: '3.4 圆的方程',
                    tags: ['圆的标准方程', '圆的一般方程', '圆的方程的应用']
                },
                {
                    section: '3.5 直线与圆的位置关系',
                    tags: ['直线与圆相交', '直线与圆相切', '直线与圆相离', '弦长公式']
                }
            ]
        },
        {
            chapter: '第4章 圆锥曲线',
            sections: [
                {
                    section: '4.1 椭圆',
                    tags: ['椭圆的定义', '椭圆的标准方程', '椭圆的几何性质', '长轴', '短轴', '焦点', '离心率']
                },
                {
                    section: '4.2 双曲线',
                    tags: ['双曲线的定义', '双曲线的标准方程', '双曲线的几何性质', '渐近线', '双曲线离心率']
                },
                {
                    section: '4.3 抛物线',
                    tags: ['抛物线的定义', '抛物线的标准方程', '抛物线的几何性质', '焦点', '准线']
                },
                {
                    section: '4.4 直线与圆锥曲线',
                    tags: ['直线与椭圆', '直线与双曲线', '直线与抛物线', '弦长问题', '中点弦问题', '点差法']
                }
            ]
        }
        ,
        {
            chapter: '第5章 概率与统计进阶',
            sections: [
                {
                    section: '5.1 离散型随机变量',
                    tags: ['随机变量', '离散型随机变量', '概率分布列']
                },
                {
                    section: '5.2 二项分布与超几何分布',
                    tags: ['二项分布', '超几何分布', 'n次独立重复试验']
                },
                {
                    section: '5.3 数字特征',
                    tags: ['数学期望', '方差', '期望的性质', '方差的性质']
                },
                {
                    section: '5.4 正态分布',
                    tags: ['正态分布', '正态曲线', '标准正态分布', '3σ原则']
                },
                {
                    section: '5.5 统计推断',
                    tags: ['独立性检验', '卡方检验', '线性回归', '回归方程']
                }
            ]
        }
    ],
    // ==================== 高三（选修与综合） ====================
    '高三': [
        {
            chapter: '第1章 导数及其应用',
            sections: [
                {
                    section: '1.1 导数的概念',
                    tags: ['导数的定义', '导数的几何意义', '切线方程']
                },
                {
                    section: '1.2 导数的运算',
                    tags: ['基本初等函数的导数', '导数的运算法则', '复合函数求导']
                },
                {
                    section: '1.3 导数与函数的单调性',
                    tags: ['导数与单调性', '利用导数判断单调区间']
                },
                {
                    section: '1.4 导数与极值、最值',
                    tags: ['极大值', '极小值', '函数的最大值', '函数的最小值', '极值点']
                },
                {
                    section: '1.5 导数的应用',
                    tags: ['导数应用题', '最优化问题', '不等式证明', '恒成立问题', '存在性问题']
                }
            ]
        },
        {
            chapter: '第2章 坐标系与参数方程',
            sections: [
                {
                    section: '2.1 参数方程',
                    tags: ['参数方程', '直线的参数方程', '圆的参数方程', '椭圆的参数方程', '参数方程与普通方程的互化']
                },
                {
                    section: '2.2 极坐标',
                    tags: ['极坐标系', '极坐标与直角坐标的互化', '极坐标方程']
                }
            ]
        },
        {
            chapter: '第3章 不等式选讲',
            sections: [
                {
                    section: '3.1 绝对值不等式',
                    tags: ['绝对值不等式', '绝对值不等式的解法', '三角不等式']
                },
                {
                    section: '3.2 柯西不等式',
                    tags: ['柯西不等式', '柯西不等式的应用']
                },
                {
                    section: '3.3 平均值不等式',
                    tags: ['算术-几何平均不等式', '平均值不等式链', '权方和不等式']
                }
            ]
        },
        {
            chapter: '第4章 空间向量与立体几何',
            sections: [
                {
                    section: '4.1 空间向量',
                    tags: ['空间向量', '空间向量的坐标', '空间向量的运算']
                },
                {
                    section: '4.2 空间向量的应用',
                    tags: ['空间角', '异面直线所成的角', '直线与平面所成的角', '二面角', '空间距离']
                }
            ]
        }
    ]
};

// ==================== 旧版标签结构(保留用于其他学科) ====================

export const STANDARD_TAGS = {
    // ==================== 数学 ====================
    math: {
        // 代数
        algebra: {
            equations: [
                "一元一次方程",
                "一元一次方程的应用",
                "一元二次方程",
                "一元二次方程求根公式",
                "一元二次方程配方法",
                "一元二次方程因式分解法",
                "一元二次方程的应用",
                "二元一次方程组",
                "三元一次方程组",
                "分式方程",
                "无理方程",
            ],
            inequalities: [
                "一元一次不等式",
                "一元一次不等式组",
                "一元二次不等式",
                "不等式的性质",
                "不等式的应用",
            ],
            expressions: [
                "整式",
                "多项式",
                "因式分解",
                "提公因式法",
                "公式法分解",
                "十字相乘法",
                "分组分解法",
                "分式",
                "分式的运算",
                "二次根式",
                "二次根式的化简",
            ],
            functions: [
                "函数的概念",
                "函数的图像",
                "一次函数",
                "一次函数的性质",
                "一次函数的应用",
                "反比例函数",
                "反比例函数的性质",
                "反比例函数的图像",
                "二次函数",
                "二次函数的图像",
                "二次函数的性质",
                "二次函数顶点式",
                "二次函数一般式",
                "二次函数的应用",
                "函数综合应用",
            ],
        },

        // 几何
        geometry: {
            basic: [
                "点线面的关系",
                "角的概念",
                "角度计算",
                "对顶角",
                "余角和补角",
                "平行线的性质",
                "平行线的判定",
                "垂线",
                "距离",
            ],
            triangles: [
                "三角形",
                "三角形的分类",
                "三角形三边关系",
                "三角形内角和",
                "三角形外角性质",
                "等腰三角形",
                "等腰三角形的性质",
                "等腰三角形的判定",
                "等边三角形",
                "直角三角形",
                "勾股定理",
                "勾股定理逆定理",
                "勾股定理的应用",
                "全等三角形",
                "全等三角形的判定",
                "全等三角形的性质",
                "相似三角形",
                "相似三角形的判定",
                "相似三角形的性质",
                "相似三角形的应用",
                "锐角三角函数",
                "正弦定理",
                "余弦定理",
            ],
            quadrilaterals: [
                "四边形",
                "平行四边形",
                "平行四边形的性质",
                "平行四边形的判定",
                "矩形",
                "矩形的性质",
                "矩形的判定",
                "菱形",
                "菱形的性质",
                "菱形的判定",
                "正方形",
                "梯形",
                "等腰梯形",
            ],
            circles: [
                "圆",
                "圆的性质",
                "圆周角定理",
                "圆心角定理",
                "弦",
                "弦的性质",
                "切线",
                "切线长定理",
                "切线的性质",
                "切线的判定",
                "圆与圆的位置关系",
                "直线与圆的位置关系",
                "圆的面积",
                "扇形面积",
                "弧长计算",
            ],
            solid: [
                "立体图形",
                "棱柱",
                "棱锥",
                "圆柱",
                "圆锥",
                "球",
                "表面积",
                "体积计算",
                "三视图",
                "展开图",
            ],
        },

        // 数与式
        numbers: [
            "有理数",
            "有理数的运算",
            "有理数的加减",
            "有理数的乘除",
            "有理数的乘方",
            "无理数",
            "实数",
            "实数的运算",
            "数轴",
            "绝对值",
            "绝对值的性质",
            "绝对值方程",
            "相反数",
            "倒数",
            "平方根",
            "算术平方根",
            "立方根",
            "科学计数法",
            "近似数",
            "有效数字",
        ],

        // 统计与概率
        statistics: [
            "数据的收集",
            "数据的整理",
            "统计图表",
            "条形统计图",
            "折线统计图",
            "扇形统计图",
            "频数分布表",
            "频数分布直方图",
            "平均数",
            "加权平均数",
            "中位数",
            "众数",
            "极差",
            "方差",
            "标准差",
            "概率",
            "概率的计算",
            "古典概型",
            "频率与概率",
        ],
    },

    // ==================== 英语 ====================
    english: {
        grammar: [
            "名词",
            "代词",
            "冠词",
            "数词",
            "形容词",
            "副词",
            "介词",
            "连词",
            "动词",
            "动词时态",
            "一般现在时",
            "一般过去时",
            "一般将来时",
            "现在进行时",
            "过去进行时",
            "现在完成时",
            "过去完成时",
            "被动语态",
            "非谓语动词",
            "动词不定式",
            "动名词",
            "分词",
            "主谓一致",
        ],
        sentence: [
            "句子成分",
            "主语",
            "谓语",
            "宾语",
            "定语",
            "状语",
            "补语",
            "简单句",
            "并列句",
            "复合句",
            "宾语从句",
            "定语从句",
            "状语从句",
            "主语从句",
            "表语从句",
            "同位语从句",
            "倒装句",
            "强调句",
            "虚拟语气",
        ],
        reading: [
            "阅读理解",
            "完形填空",
            "七选五",
            "任务型阅读",
        ],
        writing: [
            "书面表达",
            "应用文",
            "记叙文",
            "议论文",
            "说明文",
        ],
    },

    // ==================== 物理 ====================
    physics: {
        // 力学
        mechanics: {
            basic: [
                "长度的测量",
                "时间的测量",
                "速度",
                "平均速度",
                "瞬时速度",
                "匀速直线运动",
                "变速运动",
                "加速度",
                "自由落体运动",
            ],
            force: [
                "力",
                "力的作用效果",
                "力的合成",
                "力的分解",
                "重力",
                "重心",
                "弹力",
                "胡克定律",
                "摩擦力",
                "滑动摩擦力",
                "静摩擦力",
                "摩擦力的应用",
                "二力平衡",
                "牛顿第一定律",
                "惯性",
                "牛顿第二定律",
                "牛顿第三定律",
            ],
            pressure: [
                "压强",
                "压强的计算",
                "液体压强",
                "大气压强",
                "流体压强",
                "浮力",
                "阿基米德原理",
                "浮力的应用",
                "物体的浮沉条件",
            ],
            work: [
                "功",
                "功的计算",
                "功率",
                "机械效率",
                "简单机械",
                "杠杆",
                "杠杆平衡条件",
                "滑轮",
                "定滑轮",
                "动滑轮",
                "滑轮组",
                "斜面",
                "机械能",
                "动能",
                "势能",
                "重力势能",
                "弹性势能",
                "机械能守恒",
                "能量转化",
            ],
        },

        // 电学
        electricity: {
            basic: [
                "电荷",
                "摩擦起电",
                "电流",
                "电流的方向",
                "电压",
                "电阻",
                "影响电阻的因素",
                "变阻器",
            ],
            circuits: [
                "电路",
                "电路图",
                "串联电路",
                "串联电路的特点",
                "并联电路",
                "并联电路的特点",
                "欧姆定律",
                "欧姆定律的应用",
                "电阻的串联",
                "电阻的并联",
                "电路故障分析",
                "电路设计",
            ],
            power: [
                "电功",
                "电功率",
                "电功率的计算",
                "额定功率",
                "实际功率",
                "焦耳定律",
                "电热",
                "电热器",
                "家庭电路",
                "安全用电",
            ],
            magnetism: [
                "磁现象",
                "磁场",
                "磁感线",
                "电流的磁效应",
                "电磁铁",
                "电磁继电器",
                "电动机",
                "电磁感应",
                "发电机",
            ],
        },

        // 光学
        optics: [
            "光的直线传播",
            "光速",
            "光的反射",
            "平面镜成像",
            "光的折射",
            "折射定律",
            "透镜",
            "凸透镜",
            "凸透镜成像规律",
            "凸透镜的应用",
            "凹透镜",
            "眼睛和眼镜",
            "显微镜",
            "望远镜",
            "光的色散",
            "光的三原色",
        ],

        // 热学
        thermology: [
            "温度",
            "温度计",
            "熔化和凝固",
            "熔点",
            "汽化和液化",
            "沸点",
            "升华和凝华",
            "分子动理论",
            "内能",
            "比热容",
            "热量",
            "热值",
            "热机",
            "热机效率",
            "能量守恒定律",
        ],

        // 声学
        acoustics: [
            "声音的产生",
            "声音的传播",
            "声速",
            "音调",
            "响度",
            "音色",
            "噪声",
            "超声波",
            "次声波",
        ],
    },

    // ==================== 化学 ====================
    chemistry: {
        basic: [
            "物质的变化",
            "物理变化",
            "化学变化",
            "物质的性质",
            "物理性质",
            "化学性质",
            "分子",
            "原子",
            "离子",
            "元素",
            "化学式",
            "化学方程式",
            "化学方程式的配平",
            "质量守恒定律",
        ],
        elements: [
            "金属",
            "金属的性质",
            "金属活动性顺序",
            "合金",
            "铁",
            "铝",
            "铜",
            "非金属",
            "碳",
            "硅",
            "氧气",
            "氢气",
            "氮气",
            "元素周期表",
            "化合价",
        ],
        compounds: [
            "氧化物",
            "酸",
            "常见的酸",
            "酸的性质",
            "碱",
            "常见的碱",
            "碱的性质",
            "盐",
            "常见的盐",
            "盐的性质",
            "酸碱盐",
            "中和反应",
            "复分解反应",
        ],
        reactions: [
            "化合反应",
            "分解反应",
            "置换反应",
            "复分解反应",
            "氧化反应",
            "还原反应",
            "氧化还原反应",
            "燃烧",
            "缓慢氧化",
            "催化剂",
        ],
        calculation: [
            "相对原子质量",
            "相对分子质量",
            "化学式的计算",
            "化学方程式的计算",
            "溶液",
            "溶解度",
            "饱和溶液",
            "不饱和溶液",
            "溶质质量分数",
        ],
    },

};

// 标签别名映射表 - 将AI可能生成的不同表达映射到标准标签
export const TAG_ALIASES: Record<string, string> = {
    // ========== 方程相关 ==========
    "二次方程": "一元二次方程",
    "一元2次方程": "一元二次方程",
    "2次方程": "一元二次方程",
    "求根公式": "一元二次方程求根公式",
    "配方法": "一元二次方程配方法",
    "quadratic equation": "一元二次方程",
    "linear equation": "一元一次方程",
    "一次方程": "一元一次方程",
    "方程": "一元一次方程",
    "方程组": "二元一次方程组",

    // ========== 几何基础 ==========
    "勾股": "勾股定理",
    "毕达哥拉斯定理": "勾股定理",
    "毕氏定理": "勾股定理",
    "Pythagorean": "勾股定理",

    // 三角形相关
    "三角形相似": "相似三角形",
    "相似": "相似三角形",
    "三角形全等": "全等三角形",
    "全等": "全等三角形",
    "等腰": "等腰三角形",
    "等边": "等边三角形",
    "直角三角形性质": "直角三角形",

    // 四边形
    "平行四边形性质": "平行四边形",
    "矩形性质": "矩形",
    "菱形性质": "菱形",

    // 圆相关
    "圆的性质": "圆",
    "圆周角": "圆周角定理",
    "圆心角": "圆心角定理",
    "切线性质": "切线",

    // 立体几何/三视图
    "左视图": "三视图",
    "主视图": "三视图",
    "俯视图": "三视图",
    "视图": "三视图",
    "三视": "三视图",
    "立体图形的三视图": "三视图",

    // ========== 物理-运动相关 ==========
    "匀速运动": "匀速直线运动",
    "匀速": "匀速直线运动",
    "uniform motion": "匀速直线运动",
    "变速": "变速运动",
    "加速运动": "变速运动",
    "加速度": "变速运动",
    "速度计算": "速度",
    "平均速度计算": "平均速度",

    // 物理-力学
    "力的概念": "力",
    "力学": "力",
    "牛一": "牛顿第一定律",
    "牛二": "牛顿第二定律",
    "牛三": "牛顿第三定律",
    "惯性定律": "牛顿第一定律",
    "重力加速度": "重力",
    "摩擦": "摩擦力",
    "浮力计算": "浮力",
    "压强计算": "压强",
    "液体压强计算": "液体压强",

    // 物理-电学
    "欧姆": "欧姆定律",
    "串联": "串联电路",
    "并联": "并联电路",
    "电路分析": "电路",
    "电功率计算": "电功率",
    "电功计算": "电功",

    // ========== 数值相关 ==========
    "绝对值的性质": "绝对值",
    "非负数": "绝对值",
    "非负数的性质": "绝对值",
    "absolute value": "绝对值",
    "有理数运算": "有理数的运算",
    "实数运算": "实数的运算",
    "科学记数法": "科学计数法",

    // ========== 函数相关 ==========
    "二次函数性质": "二次函数的性质",
    "二次函数图像": "二次函数的图像",
    "抛物线": "二次函数",
    "反比例": "反比例函数",
    "一次函数图像": "一次函数的图像",
    "一次函数性质": "一次函数的性质",
    "函数": "函数的概念",

    // ========== 英语相关 ==========
    "时态": "动词时态",
    "语态": "被动语态",
    "从句": "复合句",
    "定从": "定语从句",
    "宾从": "宾语从句",
    "状从": "状语从句",
    "虚拟": "虚拟语气",
    "倒装": "倒装句",
    "非谓语": "非谓语动词",
    "不定式": "动词不定式",
    "ing": "动名词",
    "阅读": "阅读理解",
    "完形": "完形填空",
    "作文": "书面表达",

    // ========== 代数相关 ==========
    "因式": "因式分解",
    "分解因式": "因式分解",
    "提公因式": "提公因式法",
    "十字相乘": "十字相乘法",
    "分式运算": "分式的运算",
    "根式": "二次根式",
    "化简": "二次根式的化简",

    // ========== 统计概率 ==========
    "平均数计算": "平均数",
    "概率计算": "概率的计算",
    "统计": "统计图表",
    "方差计算": "方差",

    // ========== 化学相关 ==========
    "化学方程": "化学方程式",
    "配平": "化学方程式的配平",
    "氧化还原": "氧化还原反应",
    "中和": "中和反应",
    "酸碱": "酸碱盐",
    "溶液计算": "溶质质量分数",
    "溶解": "溶解度",
};

/**
 * 标准化标签 - 将AI生成的标签转换为标准标签
 * @param tag AI生成的原始标签
 * @returns 标准化后的标签
 */
export function normalizeTag(tag: string): string {
    const trimmed = tag.trim();

    // 1. 直接匹配别名
    if (TAG_ALIASES[trimmed]) {
        return TAG_ALIASES[trimmed];
    }

    // 2. 模糊匹配 - 检查是否包含标准标签
    const allStandardTags = getAllStandardTags();
    for (const standardTag of allStandardTags) {
        if (trimmed.includes(standardTag) || standardTag.includes(trimmed)) {
            return standardTag;
        }
    }

    // 3. 如果找不到匹配，返回原标签
    return trimmed;
}

/**
 * 标准化标签数组
 * @param tags AI生成的标签数组
 * @returns 标准化后的去重标签数组
 */
export function normalizeTags(tags: string[]): string[] {
    const normalized = tags.map(normalizeTag);
    // 去重
    return Array.from(new Set(normalized));
}

/**
 * 根据年级和学科智能匹配标准标签
 * @param tags AI生成的标签数组
 * @param grade 年级 (7-9:初中, 10-12:高中)
 * @param subjectName 学科名称
 * @returns 标准化后的去重标签数组
 */
export function normalizeTagsByGradeAndSubject(
    tags: string[],
    grade: 7 | 8 | 9 | 10 | 11 | 12 | null,
    subjectName: 'math' | 'physics' | 'chemistry' | 'english' | null
): string[] {
    const normalized = tags.map(tag => {
        const trimmed = tag.trim();

        // 1. 检查别名映射
        if (TAG_ALIASES[trimmed]) {
            const aliasTag = TAG_ALIASES[trimmed];

            // 如果指定了年级和学科,验证别名标签是否匹配
            if (grade && subjectName === 'math') {
                const mathTagInfo = getMathTagInfo(aliasTag);
                if (mathTagInfo && mathTagInfo.grade === grade) {
                    return aliasTag; // 优先返回匹配年级的标签
                }
            }

            return aliasTag;
        }

        // 2. 如果是数学学科且指定了年级,优先在该年级的数学标签中匹配
        if (subjectName === 'math' && grade) {
            const gradeTags = getMathTagsByGrade(grade);
            for (const standardTag of gradeTags) {
                if (trimmed.includes(standardTag) || standardTag.includes(trimmed)) {
                    return standardTag;
                }
            }
        }

        // 3. 如果指定了学科,在该学科的所有标签中匹配
        if (subjectName) {
            const subjectTags = getSubjectTags(subjectName);
            for (const standardTag of subjectTags) {
                if (trimmed.includes(standardTag) || standardTag.includes(trimmed)) {
                    return standardTag;
                }
            }
        }

        // 4. 跨学科检查: 如果指定了学科,且在当前学科没找到,检查是否属于其他学科
        if (subjectName) {
            const otherSubjects = ['math', 'physics', 'chemistry', 'english'].filter(s => s !== subjectName);
            for (const otherSubject of otherSubjects) {
                const otherTags = getSubjectTags(otherSubject as any);
                // 如果标签在其他学科的标准库里完全匹配,且在当前学科没找到(前面已经找过了)
                // 则认为是跨学科错误,丢弃该标签
                if (otherTags.includes(trimmed)) {
                    return null;
                }
            }
        }

        // 5. 全局模糊匹配(兜底)
        // 只有当没有指定学科,或者确信不是跨学科错误时才进行
        const allStandardTags = getAllStandardTags();
        for (const standardTag of allStandardTags) {
            if (trimmed.includes(standardTag) || standardTag.includes(trimmed)) {
                return standardTag;
            }
        }

        // 6. 如果找不到匹配,返回原标签
        return trimmed;
    }).filter(tag => tag !== null) as string[];

    // 去重
    return Array.from(new Set(normalized));
}

/**
 * 获取指定学科的所有标签
 * @param subjectName 学科名称
 * @returns 该学科的所有标签数组
 */
function getSubjectTags(subjectName: 'math' | 'physics' | 'chemistry' | 'english'): string[] {
    switch (subjectName) {
        case 'math':
            return getAllMathTags();
        case 'physics':
            return extractTagsFromSubject(STANDARD_TAGS.physics);
        case 'chemistry':
            return extractTagsFromSubject(STANDARD_TAGS.chemistry);
        case 'english':
            return extractTagsFromSubject(STANDARD_TAGS.english);
        default:
            return [];
    }
}

/**
 * 从学科数据中提取所有标签
 */
function extractTagsFromSubject(subjectData: any): string[] {
    const tags: string[] = [];
    function extract(obj: any): void {
        if (Array.isArray(obj)) {
            tags.push(...obj);
        } else if (typeof obj === 'object' && obj !== null) {
            Object.values(obj).forEach(value => extract(value));
        }
    }
    extract(subjectData);
    return tags;
}

/**
 * 从教育阶段和入学年份推算当前年级
 * @param educationStage 教育阶段 ('junior_high' 或 'senior_high')
 * @param enrollmentYear 入学年份
 * @returns 年级 (7-9:初中, 10-12:高中) 或 null
 */
export function calculateGrade(
    educationStage: string | null,
    enrollmentYear: number | null
): 7 | 8 | 9 | 10 | 11 | 12 | null {
    if (!enrollmentYear) {
        return null;
    }

    // 只处理初中和高中
    if (educationStage !== 'junior_high' && educationStage !== 'senior_high') {
        return null;
    }

    const currentYear = new Date().getFullYear();
    const currentMonth = new Date().getMonth() + 1; // 1-12

    // 计算入学后的年数
    let yearsInSchool = currentYear - enrollmentYear;

    // 如果当前月份在9月之前,说明还没开学,年级要减1
    if (currentMonth < 9) {
        yearsInSchool -= 1;
    }

    if (educationStage === 'junior_high') {
        // 初中: 入学第1年=7年级, 第2年=8年级, 第3年=9年级
        const grade = 7 + yearsInSchool;
        if (grade >= 7 && grade <= 9) {
            return grade as 7 | 8 | 9;
        }
    } else if (educationStage === 'senior_high') {
        // 高中: 入学第1年=10年级(高一), 第2年=11年级(高二), 第3年=12年级(高三)
        const grade = 10 + yearsInSchool;
        if (grade >= 10 && grade <= 12) {
            return grade as 10 | 11 | 12;
        }
    }

    return null;
}

/**
 * 从错题本名称推断学科
 * @param subjectName 错题本名称
 * @returns 学科标识
 */
export function inferSubjectFromName(subjectName: string | null): 'math' | 'physics' | 'chemistry' | 'english' | null {
    if (!subjectName) return null;

    const lowerName = subjectName.toLowerCase();

    if (lowerName.includes('math') || lowerName.includes('数学')) return 'math';
    if (lowerName.includes('physics') || lowerName.includes('物理')) return 'physics';
    if (lowerName.includes('chemistry') || lowerName.includes('化学')) return 'chemistry';
    if (lowerName.includes('english') || lowerName.includes('英语')) return 'english';

    return null;
}

/**
 * 获取所有标准标签（扁平化）
 */
export function getAllStandardTags(): string[] {
    const tags: string[] = [];

    // 1. 添加新的数学标签(从索引获取)
    tags.push(...getAllMathTags());

    // 2. 递归提取其他学科的标签(物理、化学、英语)
    function extractTags(obj: any): void {
        if (Array.isArray(obj)) {
            // 如果是数组，直接添加所有元素
            tags.push(...obj);
        } else if (typeof obj === 'object' && obj !== null) {
            // 如果是对象，递归处理所有值
            Object.values(obj).forEach(value => extractTags(value));
        }
    }

    // 提取物理、化学、英语标签(跳过旧的math结构)
    const { math, ...otherSubjects } = STANDARD_TAGS;
    extractTags(otherSubjects);

    return tags;
}

/**
 * 获取标签建议 - 基于已有标签和输入
 * @param input 用户输入
 * @param existingTags 已有的所有标签
 * @returns 建议的标签列表
 */
export function getTagSuggestions(input: string, existingTags: string[]): string[] {
    const allTags = [...new Set([...getAllStandardTags(), ...existingTags])];

    if (!input) {
        return allTags.slice(0, 10); // 返回前10个
    }

    const lowerInput = input.toLowerCase();
    const suggestions = allTags.filter(tag =>
        tag.toLowerCase().includes(lowerInput) ||
        lowerInput.includes(tag.toLowerCase())
    );

    return suggestions.slice(0, 10);
}

// ==================== 数学标签索引和查询函数 ====================

/**
 * 解析年级学期字符串
 * @param gradeSemester 如 "七年级上"
 * @returns [年级数字, 学期数字]
 */
function parseGradeSemester(gradeSemester: string): [7 | 8 | 9 | 10 | 11 | 12, 1 | 2] {
    // 初中年级映射
    const juniorGradeMap: Record<string, 7 | 8 | 9> = {
        '七年级': 7,
        '八年级': 8,
        '九年级': 9
    };

    // 高中年级映射
    const seniorGradeMap: Record<string, 10 | 11 | 12> = {
        '高一': 10,
        '高二': 11,
        '高三': 12
    };

    const semesterMap: Record<string, 1 | 2> = {
        '上': 1,
        '下': 2
    };

    // 尝试匹配初中年级
    const juniorMatch = gradeSemester.match(/(七|八|九)年级/);
    if (juniorMatch) {
        const gradeStr = juniorMatch[1] + '年级';
        const semesterMatch = gradeSemester.match(/(上|下)/);
        const semesterStr = semesterMatch ? semesterMatch[1] : '上';
        return [juniorGradeMap[gradeStr], semesterMap[semesterStr]];
    }

    // 尝试匹配高中年级
    const seniorMatch = gradeSemester.match(/(高一|高二|高三)/);
    if (seniorMatch) {
        const gradeStr = seniorMatch[1];
        const semesterMatch = gradeSemester.match(/(上|下)/);
        const semesterStr = semesterMatch ? semesterMatch[1] : '上';
        return [seniorGradeMap[gradeStr], semesterMap[semesterStr]];
    }

    // 默认返回七年级上
    return [7, 1];
}

/**
 * 构建数学标签索引
 * 从 MATH_CURRICULUM 自动生成扁平索引,用于快速查询
 */
function buildMathTagIndex(): Map<string, MathTagIndex> {
    const index = new Map<string, MathTagIndex>();

    Object.entries(MATH_CURRICULUM).forEach(([gradeSemester, chapters]) => {
        const [grade, semester] = parseGradeSemester(gradeSemester);

        chapters.forEach(({ chapter, sections }) => {
            sections.forEach(({ section, tags, subsections }) => {
                // 处理直接在 section 下的 tags
                tags?.forEach(tag => {
                    index.set(tag, {
                        name: tag,
                        grade,
                        semester,
                        chapter,
                        section,
                        path: `${gradeSemester}/${chapter}/${section}`
                    });
                });

                // 处理 subsections
                subsections?.forEach(({ subsection, tags: subTags }) => {
                    subTags.forEach(tag => {
                        index.set(tag, {
                            name: tag,
                            grade,
                            semester,
                            chapter,
                            section: subsection,
                            path: `${gradeSemester}/${chapter}/${subsection}`
                        });
                    });
                });
            });
        });
    });

    return index;
}

/**
 * 数学标签索引(自动生成)
 */
export const MATH_TAG_INDEX: Map<string, MathTagIndex> = buildMathTagIndex();

/**
 * 获取所有数学标签(扁平数组)
 */
export function getAllMathTags(): string[] {
    return Array.from(MATH_TAG_INDEX.keys());
}

/**
 * 按年级和学期筛选数学标签
 * 直接从课程大纲按顺序获取，保证标签按章节顺序排列
 * @param grade 年级 (7-9:初中, 10-12:高中)
 * @param semester 学期 (1=上, 2=下),可选
 * @returns 标签名称数组（按课程顺序）
 */
export const GRADE_TO_KEYS_MAP: Record<number, string[]> = {
    7: ['七年级上', '七年级下'],
    8: ['八年级上', '八年级下'],
    9: ['九年级上', '九年级下'],
    10: ['高一上', '高一下'],
    11: ['高二上', '高二下'],
    12: ['高三']
};

export function getMathTagsByGrade(grade: 7 | 8 | 9 | 10 | 11 | 12, semester?: 1 | 2): string[] {
    const tags: string[] = [];

    const keys = GRADE_TO_KEYS_MAP[grade] || [];

    keys.forEach(key => {
        // 如果指定了学期，只获取对应学期
        if (semester) {
            const expectedSemester = key.includes('上') ? 1 : 2;
            // 高三没有上下学期区分，总是包含
            if (expectedSemester !== semester && !key.includes('高三')) {
                return;
            }
        }

        const chapters = MATH_CURRICULUM[key];
        if (!chapters) return;

        chapters.forEach(({ sections }) => {
            sections.forEach(({ tags: sectionTags, subsections }) => {
                // 添加 section 级别的标签
                if (sectionTags) {
                    tags.push(...sectionTags);
                }
                // 添加 subsection 级别的标签
                if (subsections) {
                    subsections.forEach(({ tags: subTags }) => {
                        tags.push(...subTags);
                    });
                }
            });
        });
    });

    return Array.from(new Set(tags));
}

/**
 * 按章节筛选数学标签
 * @param chapter 章节名称,如 "第1章 有理数"
 * @returns 标签名称数组
 */
export function getMathTagsByChapter(chapter: string): string[] {
    return Array.from(MATH_TAG_INDEX.values())
        .filter(tag => tag.chapter === chapter)
        .map(tag => tag.name);
}

/**
 * 获取标签的元数据信息
 * @param tagName 标签名称
 * @returns 标签的元数据,如果不存在则返回 undefined
 */
export function getMathTagInfo(tagName: string): MathTagIndex | undefined {
    return MATH_TAG_INDEX.get(tagName);
}

/**
 * 获取完整的数学课程大纲
 */
export function getMathCurriculum(): MathCurriculum {
    return MATH_CURRICULUM;
}

